(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(...e){for(let t=0;t<e.length;t++){const n=e[t];if(null!=n&&""!==n)return n}}function s(e,t){if(!e||!e.length)return;if(!t)return e[0];const n=e[0];return n&&"object"==typeof n?n[t]:n}function a(e){if(!e||"object"!=typeof e)return e;const t=[e.street||e.line1||e.address1,e.line2||e.address2,e.city,e.region||e.state,e.postal_code||e.postalCode||e.zip,e.country].filter(Boolean);return t.length?t.join(", "):void 0}function i(){const[i,o]=(0,e.useState)(!1),[l,d]=(0,e.useState)(!0),[r,c]=(0,e.useState)(null),[u,m]=(0,e.useState)(null),[v,h]=(0,e.useState)("");(0,e.useEffect)(()=>{const e=async()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();if(o(e),e){const e=await window.Eventive.request({method:"GET",path:"people/self",authenticatePerson:!0}),t=e&&(e.person||e);window.eventivePersonId=t&&t.id;const i=function(e){if(!e||"object"!=typeof e)return{};const t=e.details||{},i=e.addresses||t.addresses,o=e.phones||t.phones,l=e.emails||t.emails;return{name:n(e.name,t.name,e.full_name,e.fullName,e.first_name&&e.last_name?e.first_name+" "+e.last_name:void 0,t.first_name&&t.last_name?t.first_name+" "+t.last_name:void 0),email:n(e.email,t.email,s(l,"email")),phone_number:n(e.phone_number,t.phone_number,e.phone,t.phone,e.phoneNumber,t.phoneNumber,s(o,"number")),mailing_address:n(a(e.mailing_address),a(t.mailing_address),a(e.address),a(t.address),a(s(i)),e.mailing_address,t.mailing_address,e.address,t.address,s(i)),sms_tickets_enabled:n(e.sms_tickets_enabled,t.sms_tickets_enabled),_raw:e}}(t||{});i&&0!==Object.keys(i).length?console.debug("[account-details] normalized person",i):console.warn("[account-details] Empty/unknown person payload from people/self",e),c(i),setTimeout(()=>{if(window.Eventive&&"function"==typeof window.Eventive.renderButtons)try{window.Eventive.renderButtons()}catch(e){}},100)}}catch(e){console.error("[eventive-account-details] Error fetching account details:",e),!e||"InvalidCredentials"!==e.code&&"InvalidCredentials"!==e.message||o(!1)}finally{d(!1)}else setTimeout(e,100)};if(!window.Eventive||!window.Eventive.on){const e=setTimeout(()=>{d(!1)},2500);return()=>clearTimeout(e)}window.Eventive.on("ready",e)},[]);const p=()=>{m(null),h("")};if(l)return(0,t.jsx)("div",{className:"eventive-login-container",children:(0,t.jsx)("div",{className:"loader"})});if(!i)return(0,t.jsx)("div",{className:"eventive-notice",children:"Please log in to view your account details."});if(!r)return(0,t.jsx)("div",{className:"eventive-notice",children:"Unable to load account details."});const _={name:"Name",email:"Email",phone_number:"Phone Number",mailing_address:"Mailing Address"};return r&&Object.prototype.hasOwnProperty.call(r,"sms_tickets_enabled")&&(_.sms_tickets_enabled="SMS Tickets Enabled"),(0,t.jsx)("div",{className:"eventive-account-details",children:(0,t.jsxs)("div",{className:"eventive-account-details-content",children:[(0,t.jsx)("h2",{children:"My Account Details"}),(0,t.jsxs)("table",{className:"styled-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Field"}),(0,t.jsx)("th",{children:"Value"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:Object.keys(_).map(e=>{const n=_[e];let i=r[e];if(void 0===i){const t=r._raw||{};"phone_number"===e&&(i=r.phone||r.phoneNumber||t.details&&(t.details.phone||t.details.phone_number)||t.phones&&s(t.phones,"number")),"mailing_address"===e&&(i=r.address||r.mailingAddress||r.mailing_address||t.details&&(t.details.address||t.details.mailing_address)||a(s(t.addresses))),"name"===e&&(i=t&&(t.name||t.full_name||t.first_name&&t.last_name&&t.first_name+" "+t.last_name)),"email"===e&&(i=t&&(t.email||t.emails&&s(t.emails,"email")))}if("mailing_address"===e&&i&&"object"==typeof i){const e=[i.street||i.line1,i.line2,i.city,i.region||i.state,i.postal_code||i.postalCode,i.country].filter(Boolean);i=e.join(", ")}const o=null!=i&&""!==i?i:"Not Set",l="boolean"==typeof o?o?"Yes":"No":o,d=u===e;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:n}),(0,t.jsx)("td",{className:"static-value",children:d?"sms_tickets_enabled"===e?(0,t.jsxs)("select",{value:v,onChange:e=>h(e.target.value),className:"edit-select",children:[(0,t.jsx)("option",{value:"true",children:"Yes"}),(0,t.jsx)("option",{value:"false",children:"No"})]}):(0,t.jsx)("input",{type:"text",value:v,onChange:e=>h(e.target.value),className:"edit-input"}):l}),(0,t.jsx)("td",{children:"sms_tickets_enabled"===e?(0,t.jsxs)("label",{className:"toggle-switch",children:[(0,t.jsx)("input",{type:"checkbox",className:"sms-toggle",checked:!0===o,onChange:e=>(async e=>{try{const t=window.eventivePersonId;if(!t)return;const n={sms_tickets_enabled:e};await window.Eventive.request({method:"POST",path:`people/${t}`,authenticatePerson:!0,data:n}),c({...r,sms_tickets_enabled:e})}catch(e){console.error("[eventive-account-details] Error updating SMS setting:",e)}})(e.target.checked)}),(0,t.jsx)("span",{className:"slider"})]}):d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"submit-row-button",onClick:()=>(async e=>{try{const t=window.eventivePersonId;if(!t)return void alert("Missing person ID");const n={};n[e]=v,await window.Eventive.request({method:"POST",path:`people/${t}`,authenticatePerson:!0,data:n}),c({...r,[e]:v}),m(null),h("")}catch(e){console.error("[eventive-account-details] Error submitting update:",e),alert("Failed to save changes. Please try again.")}})(e),children:"Submit"})," ",(0,t.jsx)("button",{className:"cancel-row-button",onClick:p,children:"Cancel"})]}):(0,t.jsx)("button",{className:"edit-row-button",onClick:()=>((e,t)=>{m(e),h("Not Set"===t?"":t)})(e,l),children:"Edit"})})]},e)})})]}),(0,t.jsx)("div",{className:"eventive-account-actions",children:(0,t.jsx)("div",{className:"eventive-button","data-payment":"true","data-label":"Manage Payment Details"})})]})})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-details").forEach(n=>{n.__evtInited||(n.__evtInited=!0,(0,e.createRoot)(n).render((0,t.jsx)(i,{})))})})})();