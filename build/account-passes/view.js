(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime;function t(...e){for(let s=0;s<e.length;s++){const t=e[s];if(null!=t&&""!==t)return t}return""}function n({bucket:n}){const[a,i]=(0,e.useState)(!1),[l,r]=(0,e.useState)(!0),[c,o]=(0,e.useState)([]),[d,p]=(0,e.useState)(!1),[u,m]=(0,e.useState)(!1),[v,h]=(0,e.useState)(null),[y,b]=(0,e.useState)(-1),[j,x]=(0,e.useState)(null),[w,g]=(0,e.useState)({});(0,e.useEffect)(()=>{const e=()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();i(e),e&&f()}catch(e){console.error("Error checking login:",e)}finally{r(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on?window.Eventive.on("ready",e):e()},[]);const f=()=>{const e={};if(n)try{e.conditions=JSON.stringify({event_bucket:n})}catch(e){}window.Eventive.request({method:"GET",path:"people/self/passes",qs:e,authenticatePerson:!0}).then(e=>{const s=e&&(e.passes||e)||[];o(s)}).catch(()=>{window.Eventive.request({method:"GET",path:"people/self/passes_including_global",qs:e,authenticatePerson:!0}).then(e=>{const s=e&&(e.passes||e)||[];o(s)}).catch(e=>{console.error("[eventive-account-passes] Error fetching passes:",e)})})},N=()=>{p(!1),m(!1),h(null),b(-1),x(null),g({})};return(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&N()};return(d||u)&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[d,u]),l?(0,s.jsx)("div",{className:"eventive-login-container",children:(0,s.jsx)("div",{className:"loader"})}):a?(0,s.jsxs)("div",{className:"eventive-account-passes",children:[(0,s.jsxs)("div",{className:"eventive-passes-list",children:[(0,s.jsx)("h2",{children:"My Passes"}),0===c.length?(0,s.jsx)("p",{children:"No passes found for this account."}):(0,s.jsx)("div",{className:"eventive-passes-grid",children:c.map((e,n)=>{const a=t(e.name,e.pass_name,e.title,"Pass"),i=t(e.type,e.pass&&e.pass.type),l=null!=e.events_remaining?`${e.events_remaining} left`:"",r=null!=e.gross_cents?function(e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(e/100)}catch(s){return"$"+(e/100||0)}}(e.gross_cents):"",c=e.benefits&&Array.isArray(e.benefits)?e.benefits.join(", "):"",o=[i,l,r].filter(Boolean).join(" • ");return(0,s.jsxs)("div",{className:"eventive-pass-card",children:[(0,s.jsxs)("div",{className:"eventive-pass-card__body",children:[(0,s.jsx)("div",{className:"eventive-pass-card__title",children:a}),o&&(0,s.jsx)("div",{className:"eventive-pass-card__meta",children:o}),c&&(0,s.jsx)("div",{className:"eventive-pass-card__benefits",children:c})]}),(0,s.jsxs)("div",{className:"eventive-pass-card__actions",children:[(0,s.jsx)("button",{className:"evt-btn evt-btn-secondary",onClick:()=>((e,s)=>{h(e),b(s),g({name:t(e.name,e.pass_name,""),supplementary:e.supplementary_data||{}}),p(!0)})(e,n),children:"Edit"}),(0,s.jsx)("button",{className:"evt-btn evt-btn-primary",onClick:()=>(e=>{x(e),m(!0)})(e),children:"Show Barcode"})]})]},n)})})]}),u&&j&&(0,s.jsx)("div",{className:"eventive-show-pass-barcode-modal is-open",onClick:e=>e.target.classList.contains("eventive-show-pass-barcode-modal")&&N(),children:(0,s.jsxs)("div",{className:"show-pass-barcode-modal-content",children:[(0,s.jsx)("button",{className:"modal-close-btn",onClick:N,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{className:"barcode-modal-title",children:"My Pass Credentials"}),(0,s.jsx)("div",{className:"barcode-meta",children:t(j.name,j.pass_name,"Pass")}),(()=>{const e=(n=t(j.qr_code_path,j.barcode_path,j.barcode&&j.barcode.path))?/^https?:\/\//i.test(n)?n:"https://api.eventive.org"+("/"===n.charAt(0)?"":"/")+n:n;var n;return e?(0,s.jsx)("img",{className:"barcode-img",src:e,alt:`${j.name||"Pass"} QR Code`}):(0,s.jsx)("p",{children:"No barcode available"})})(),(0,s.jsx)("div",{className:"barcode-tip",children:"Present this code at entry. Tip: increase screen brightness for easier scanning."})]})}),d&&v&&(0,s.jsx)("div",{className:"eventive-edit-pass-modal is-open",onClick:e=>e.target.classList.contains("eventive-edit-pass-modal")&&N(),children:(0,s.jsxs)("div",{className:"edit-pass-modal-content",children:[(0,s.jsx)("button",{className:"modal-close-btn",onClick:N,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{children:"Edit Pass Details"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const s={};w.name&&""!==w.name.trim()&&(s.name=w.name.trim()),w.supplementary&&Object.keys(w.supplementary).length&&(s.supplementary_data=w.supplementary);const t=v.id||v.pass&&v.pass.id;t?window.Eventive.request({method:"POST",path:"passes/"+encodeURIComponent(t),body:s,authenticatePerson:!0}).then(()=>{N(),f()}).catch(e=>{console.error("Failed to update pass:",e),alert("Failed to update pass.")}):console.warn("[passes] missing pass id")},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Pass Name"}),(0,s.jsx)("input",{type:"text",value:w.name||"",onChange:e=>g({...w,name:e.target.value}),required:!0})]}),v.supplementary_data&&(()=>{const e=v.supplementary_data;return Array.isArray(e)?e.map((e,t)=>{const n=e.key||e.name||e.id,a=e.label||e.name||n,i=null!=w.supplementary?.[n]?w.supplementary[n]:null!=e.value?e.value:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:a||n}),(0,s.jsx)("input",{type:"text",value:i,onChange:e=>g({...w,supplementary:{...w.supplementary,[n]:e.target.value}})})]},t)}):"object"==typeof e&&null!==e?Object.keys(e).map(t=>{const n=null!=w.supplementary?.[t]?w.supplementary[t]:null!=e[t]?e[t]:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:t}),(0,s.jsx)("input",{type:"text",value:n,onChange:e=>g({...w,supplementary:{...w.supplementary,[t]:e.target.value}})})]},t)}):null})(),(0,s.jsx)("div",{className:"form-submit-row",children:(0,s.jsx)("button",{type:"submit",className:"pass-submit-row-button",children:"Save Changes"})})]})]})})]}):(0,s.jsx)("div",{className:"eventive-notice",children:"Please log in to view your passes."})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-passes").forEach(t=>{const a=window.EventiveBlockData?.eventBucket||"";(0,e.createRoot)(t).render((0,s.jsx)(n,{bucket:a}))})})})();