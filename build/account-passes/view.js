(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime;function t(...e){for(let s=0;s<e.length;s++){const t=e[s];if(null!=t&&""!==t)return t}return""}function n({bucket:n}){const[a,l]=(0,e.useState)(!1),[i,r]=(0,e.useState)(!0),[o,c]=(0,e.useState)([]),[d,v]=(0,e.useState)(!1),[m,u]=(0,e.useState)(!1),[p,h]=(0,e.useState)(null),[y,b]=(0,e.useState)(-1),[j,x]=(0,e.useState)(null),[g,w]=(0,e.useState)({});(0,e.useEffect)(()=>{const e=()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();l(e),e&&f()}catch(e){console.error("Error checking login:",e)}finally{r(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on?window.Eventive.on("ready",e):e()},[]);const f=()=>{const e={};if(n)try{e.conditions=JSON.stringify({event_bucket:n})}catch(e){}window.Eventive.request({method:"GET",path:"people/self/passes",qs:e,authenticatePerson:!0}).then(e=>{const s=e&&(e.passes||e)||[];c(s)}).catch(()=>{window.Eventive.request({method:"GET",path:"people/self/passes_including_global",qs:e,authenticatePerson:!0}).then(e=>{const s=e&&(e.passes||e)||[];c(s)}).catch(e=>{console.error("[eventive-account-passes] Error fetching passes:",e)})})},N=()=>{v(!1),u(!1),h(null),b(-1),x(null),w({})};return(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&N()};return(d||m)&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[d,m]),i?(0,s.jsx)("div",{className:"eventive-login-container",children:(0,s.jsx)("div",{className:"loader"})}):a?(0,s.jsxs)("div",{className:"eventive-account-passes",children:[(0,s.jsxs)("div",{className:"eventive-passes-list",children:[(0,s.jsx)("h2",{children:"My Passes"}),0===o.length?(0,s.jsx)("p",{children:"No passes found for this account."}):(0,s.jsx)("div",{className:"eventive-passes-grid",children:o.map((e,n)=>{const a=t(e.name,e.pass_name,e.title,"Pass"),l=t(e.type,e.pass&&e.pass.type),i=null!=e.events_remaining?`${e.events_remaining} left`:"",r=null!=e.gross_cents?function(e){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD"}).format(e/100)}catch(s){return"$"+(e/100||0)}}(e.gross_cents):"",o=e.benefits&&Array.isArray(e.benefits)?e.benefits.join(", "):"",c=[l,i,r].filter(Boolean).join(" • ");return(0,s.jsxs)("div",{className:"eventive-pass-card",children:[(0,s.jsxs)("div",{className:"eventive-pass-card__body",children:[(0,s.jsx)("div",{className:"eventive-pass-card__title",children:a}),c&&(0,s.jsx)("div",{className:"eventive-pass-card__meta",children:c}),o&&(0,s.jsx)("div",{className:"eventive-pass-card__benefits",children:o})]}),(0,s.jsxs)("div",{className:"eventive-pass-card__actions",children:[(0,s.jsx)("button",{className:"evt-btn evt-btn-secondary",onClick:()=>((e,s)=>{h(e),b(s),w({name:t(e.name,e.pass_name,""),supplementary:e.supplementary_data||{}}),v(!0)})(e,n),children:"Edit"}),(0,s.jsx)("button",{className:"evt-btn evt-btn-primary",onClick:()=>(e=>{x(e),u(!0)})(e),children:"Show Barcode"})]})]},n)})})]}),m&&j&&(0,s.jsx)("div",{className:"eventive-modal-overlay eventive-modal-overlay--dark",onClick:e=>e.target.classList.contains("eventive-modal-overlay")&&N(),children:(0,s.jsxs)("div",{className:"eventive-modal-panel eventive-modal-panel--small show-pass-barcode-modal-content",children:[(0,s.jsx)("button",{className:"eventive-modal-close-btn",onClick:N,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{className:"barcode-modal-title",children:"My Pass Credentials"}),(0,s.jsx)("div",{className:"barcode-meta",children:t(j.name,j.pass_name,"Pass")}),(()=>{const e=(n=t(j.qr_code_path,j.barcode_path,j.barcode&&j.barcode.path))?/^https?:\/\//i.test(n)?n:"https://api.eventive.org"+("/"===n.charAt(0)?"":"/")+n:n;var n;return e?(0,s.jsx)("img",{className:"barcode-img",src:e,alt:`${j.name||"Pass"} QR Code`}):(0,s.jsx)("p",{children:"No barcode available"})})(),(0,s.jsx)("div",{className:"barcode-tip",children:"Present this code at entry. Tip: increase screen brightness for easier scanning."})]})}),d&&p&&(0,s.jsx)("div",{className:"eventive-modal-overlay",onClick:e=>e.target.classList.contains("eventive-modal-overlay")&&N(),children:(0,s.jsxs)("div",{className:"eventive-modal-panel edit-pass-modal-content",children:[(0,s.jsx)("button",{className:"eventive-modal-close-btn",onClick:N,"aria-label":"Close",children:"×"}),(0,s.jsx)("h3",{children:"Edit Pass Details"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();const s={};g.name&&""!==g.name.trim()&&(s.name=g.name.trim()),g.supplementary&&Object.keys(g.supplementary).length&&(s.supplementary_data=g.supplementary);const t=p.id||p.pass&&p.pass.id;t?window.Eventive.request({method:"POST",path:"passes/"+encodeURIComponent(t),body:s,authenticatePerson:!0}).then(()=>{N(),f()}).catch(e=>{console.error("Failed to update pass:",e),alert("Failed to update pass.")}):console.warn("[passes] missing pass id")},children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Pass Name"}),(0,s.jsx)("input",{type:"text",value:g.name||"",onChange:e=>w({...g,name:e.target.value}),required:!0})]}),p.supplementary_data&&(()=>{const e=p.supplementary_data;return Array.isArray(e)?e.map((e,t)=>{const n=e.key||e.name||e.id,a=e.label||e.name||n,l=null!=g.supplementary?.[n]?g.supplementary[n]:null!=e.value?e.value:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:a||n}),(0,s.jsx)("input",{type:"text",value:l,onChange:e=>w({...g,supplementary:{...g.supplementary,[n]:e.target.value}})})]},t)}):"object"==typeof e&&null!==e?Object.keys(e).map(t=>{const n=null!=g.supplementary?.[t]?g.supplementary[t]:null!=e[t]?e[t]:"";return(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:t}),(0,s.jsx)("input",{type:"text",value:n,onChange:e=>w({...g,supplementary:{...g.supplementary,[t]:e.target.value}})})]},t)}):null})(),(0,s.jsx)("div",{className:"form-submit-row",children:(0,s.jsx)("button",{type:"submit",className:"pass-submit-row-button",children:"Save Changes"})})]})]})})]}):(0,s.jsx)("div",{className:"eventive-notice",children:"Please log in to view your passes."})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-passes").forEach(t=>{const a=window.EventiveBlockData?.eventBucket||"";(0,e.createRoot)(t).render((0,s.jsx)(n,{bucket:a}))})})})();