(()=>{"use strict";const e=window.wp.element,t=window.ReactJSXRuntime;function n(...e){for(let t=0;t<e.length;t++){const n=e[t];if(null!=n&&""!==n)return n}return""}function s(e){const t=e.event||e.screening||e.showing||{};return n(e.name,t.name,t.title,"Ticket")}function i(e){const t=e.event||e.screening||e.showing||{},s=n(t.start_time,t.begins_at,t.starts_at,e.starts_at),i=n(t.venue&&t.venue.name,t.venue_name,e.venue_name),c=[];return s&&c.push(function(e){try{const t=new Date(e);return!e||isNaN(t)?"":t.toLocaleString([],{dateStyle:"medium",timeStyle:"short"})}catch(t){return e||""}}(s)),i&&c.push(i),c.join(" • ")}function c(e){const t=e.event||e.screening||e.showing||{};return!!n(e.is_virtual,t.is_virtual,t.virtual)}function a(e){const t=e.event||e.screening||e.showing||{},s=n(t.start_time,t.begins_at,t.starts_at,e.starts_at),i=Date.parse(s||"");return isNaN(i)?null:i}function r(e){const t=a(e);return null!==t&&t<Date.now()}function l(e){const t=n(e.scanned_at,e.scan&&e.scan.scanned_at);if(!t)return"";try{return new Date(t).toLocaleString([],{dateStyle:"medium",timeStyle:"short"})}catch(e){return String(t)}}function o({bucket:o}){const[d,v]=(0,e.useState)(!1),[u,h]=(0,e.useState)(!0),[m,g]=(0,e.useState)([]),[j,p]=(0,e.useState)("all"),[x,w]=(0,e.useState)(!1),[b,k]=(0,e.useState)(null);(0,e.useEffect)(()=>{const e=()=>{if(window.Eventive&&window.Eventive.isLoggedIn)try{const e=window.Eventive.isLoggedIn();v(e),e&&N()}catch(e){console.error("Error checking login:",e)}finally{h(!1)}else setTimeout(e,100)};window.Eventive&&window.Eventive.on?window.Eventive.on("ready",e):e()},[]);const N=()=>{const e={};if(o)try{e.conditions=JSON.stringify({event_bucket:o})}catch(e){}window.Eventive.request({method:"GET",path:"people/self/tickets",qs:e,authenticatePerson:!0}).then(e=>{const t=e&&(e.tickets||e)||[];g(t)}).catch(()=>{window.Eventive.request({method:"GET",path:"people/self/tickets_including_global",qs:e,authenticatePerson:!0}).then(e=>{const t=e&&(e.tickets||e)||[];g(t)}).catch(e=>{console.error("[eventive-account-tickets] Error fetching tickets:",e)})})},f=()=>{w(!1),k(null)};(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&f()};return x&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[x]),(0,e.useEffect)(()=>{m.length>0&&setTimeout(()=>{if(window.Eventive&&window.Eventive.rebuild)try{window.Eventive.rebuild()}catch(e){}},100)},[m,j]);const _=(e,a)=>{const o=s(e),d=i(e),v=function(e){const t=n(e.seat_label,e.seat,e.seat&&e.seat.name),s=n(e.row_label,e.row),i=n(e.section_label,e.section),c=[];return i&&c.push("Sec "+i),s&&c.push("Row "+s),t&&c.push("Seat "+t),c.join(" · ")}(e),u=c(e),h=r(e),m=l(e),g=function(e){if(!c(e))return!1;const t=function(e){const t=e.event||e.screening||e.showing||{},s=n(e.unlocked_until,e.virtual_unlocked_until,t.unlocked_until,t.virtual_unlocked_until),i=Date.parse(s||"");return isNaN(i)?null:i}(e);return null!==t&&t<Date.now()}(e),j=(p=e).event&&p.event.id?p.event.id:"";var p;return(0,t.jsxs)("div",{className:"eventive-ticket-card",children:[(0,t.jsxs)("div",{className:"eventive-ticket-card__body",children:[(0,t.jsx)("div",{className:"eventive-ticket-card__title",children:o}),(0,t.jsxs)("div",{children:[m&&(0,t.jsxs)("span",{className:"evt-badge evt-badge-scanned",children:["Scanned ",m]}),!u&&h&&(0,t.jsx)("span",{className:"evt-badge evt-badge-past",children:"Event passed"}),u&&g&&(0,t.jsx)("span",{className:"evt-badge evt-badge-expired",children:"Virtual window closed"})]}),(0,t.jsx)("div",{className:"eventive-ticket-card__meta",children:d}),v&&(0,t.jsx)("div",{className:"eventive-ticket-card__seat",children:v})]}),(0,t.jsx)("div",{className:"eventive-ticket-card__actions",children:u?g?(0,t.jsx)("span",{className:"evt-badge evt-badge-expired",children:"Virtual window closed"}):(0,t.jsx)("div",{className:"eventive-button","data-event":j||""}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"evt-btn evt-btn-secondary",onClick:()=>(e=>{k(e),w(!0)})(e),children:"Show Code"}),j&&(0,t.jsx)("div",{className:"eventive-button","data-vote-event":j,"data-vote":"true"})]})})]},a)};if(u)return(0,t.jsx)("div",{className:"eventive-login-container",children:(0,t.jsx)("div",{className:"loader"})});if(!d)return(0,t.jsx)("div",{className:"eventive-notice",children:"Please log in to view your tickets."});if(0===m.length)return(0,t.jsx)("div",{className:"eventive-account-tickets",children:(0,t.jsxs)("div",{className:"eventive-tickets-column",children:[(0,t.jsx)("h2",{children:"Tickets"}),(0,t.jsx)("p",{children:"No tickets found for this account."})]})});const{upcoming:y,virtuals:E,past:S}=(()=>{const e=Date.now(),t=[],n=[],s=[];return m.forEach(i=>{const r=a(i);c(i)?n.push(i):null!==r&&r>=e?t.push(i):s.push(i)}),{upcoming:t,virtuals:n,past:s}})();let L=y,T=E,D=S;return"upcoming"===j?(T=[],D=[]):"virtual"===j?(L=[],D=[]):"past"===j&&(L=[],T=[]),(0,t.jsxs)("div",{className:"eventive-account-tickets",children:[(0,t.jsxs)("div",{className:"eventive-tickets-column",children:[(0,t.jsx)("h2",{children:"Tickets"}),(0,t.jsxs)("div",{className:"eventive-ticket-filters",children:[(0,t.jsx)("label",{htmlFor:"ticket-filter",children:"Show:"}),(0,t.jsxs)("select",{id:"ticket-filter",className:"eventive-ticket-filter-select",value:j,onChange:e=>p(e.target.value),children:[(0,t.jsx)("option",{value:"all",children:"All"}),(0,t.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,t.jsx)("option",{value:"virtual",children:"Virtual"}),(0,t.jsx)("option",{value:"past",children:"Past"})]})]}),L.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"eventive-ticket-section",children:"Upcoming"}),L.map(_)]}),T.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"eventive-ticket-section",children:"Virtual"}),T.map(_)]}),D.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"eventive-ticket-section",children:"Past"}),D.map(_)]})]}),x&&b&&(0,t.jsx)("div",{className:"eventive-ticket-barcode-modal is-open",onClick:e=>e.target.classList.contains("eventive-ticket-barcode-modal")&&f(),children:(0,t.jsxs)("div",{className:"barcode-modal-inner",children:[(0,t.jsx)("button",{className:"modal-close-btn",onClick:f,"aria-label":"Close",children:"×"}),(0,t.jsxs)("div",{className:"barcode-modal-body",children:[(0,t.jsx)("h3",{children:s(b)}),i(b)&&(0,t.jsx)("div",{className:"barcode-meta",children:i(b)}),l(b)&&(0,t.jsx)("div",{className:"barcode-scanned-badge",children:(0,t.jsxs)("span",{children:["Scanned"," ",l(b)]})}),(()=>{const e=(i=n((s=b).qr_code_path,s.barcode_path,s.barcode&&s.barcode.path))?/^https?:\/\//i.test(i)?i:"https://api.eventive.org"+("/"===i.charAt(0)?"":"/")+i:i;var s,i;const c=r(b);return e?(0,t.jsxs)("div",{className:"barcode-qr-container",children:[(0,t.jsx)("img",{src:e,alt:"Ticket QR"}),c&&(0,t.jsx)("div",{className:"past-event-overlay",children:(0,t.jsxs)("div",{className:"overlay-content",children:[(0,t.jsx)("div",{className:"overlay-title",children:"This event has passed"}),(0,t.jsx)("div",{className:"overlay-subtitle",children:"Barcode disabled"})]})})]}):(0,t.jsx)("p",{children:"No barcode available."})})()]})]})})]})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-eventive-account-tickets").forEach(n=>{(0,e.createRoot)(n).render((0,t.jsx)(o,{}))})})})();